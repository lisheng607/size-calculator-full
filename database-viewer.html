<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•°æ®åº“è®°å½•æŸ¥çœ‹ - èº«æå°ºç è®¡ç®—å™¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: white;
      margin-bottom: 30px;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .stat-label {
      color: #666;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .stat-value {
      color: #667eea;
      font-size: 32px;
      font-weight: bold;
    }

    .controls {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .btn {
      padding: 12px 24px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      transition: all 0.3s;
    }

    .btn:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }

    .table-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      background: #f8f9fa;
      color: #333;
      font-weight: 600;
      text-align: left;
      padding: 15px 12px;
      border-bottom: 2px solid #e0e0e0;
      font-size: 14px;
      white-space: nowrap;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid #f0f0f0;
      font-size: 14px;
    }

    tr:hover {
      background: #f8f9fa;
    }

    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
    }

    .badge-female {
      background: #ffe4e6;
      color: #e91e63;
    }

    .badge-male {
      background: #e3f2fd;
      color: #2196f3;
    }

    .size-badge {
      background: #667eea;
      color: white;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: white;
      font-size: 18px;
    }

    .spinner {
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .error {
      background: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #ef9a9a;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 1.8em;
      }
      
      .controls {
        flex-direction: column;
        gap: 10px;
      }
      
      table {
        font-size: 12px;
      }
      
      th, td {
        padding: 8px 6px;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <h1>ğŸ“Š æ•°æ®åº“è®°å½•æŸ¥çœ‹</h1>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <div class="stats">
    <div class="stat-card">
      <div class="stat-label">æ€»è®°å½•æ•°</div>
      <div class="stat-value" id="totalCount">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">å¥³æ€§ç”¨æˆ·</div>
      <div class="stat-value" id="femaleCount">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ç”·æ€§ç”¨æˆ·</div>
      <div class="stat-value" id="maleCount">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">å¹³å‡BMI</div>
      <div class="stat-value" id="avgBmi">-</div>
    </div>
  </div>

  <!-- æ§åˆ¶æ  -->
  <div class="controls">
    <div style="color: #666; font-size: 14px;">
      æœ€æ–°20æ¡è®°å½• Â· è‡ªåŠ¨åˆ·æ–°
    </div>
    <button class="btn" onclick="loadData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
  </div>

  <!-- é”™è¯¯æç¤º -->
  <div id="errorMsg" class="error" style="display: none;"></div>

  <!-- åŠ è½½çŠ¶æ€ -->
  <div id="loading" class="loading">
    <div class="spinner"></div>
    <p>æ­£åœ¨åŠ è½½æ•°æ®...</p>
  </div>

  <!-- æ•°æ®è¡¨æ ¼ -->
  <div id="tableContainer" class="table-container" style="display: none;">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>æ€§åˆ«</th>
          <th>èº«é«˜</th>
          <th>ä½“é‡</th>
          <th>èƒ¸å›´</th>
          <th>è…°å›´</th>
          <th>è‡€å›´</th>
          <th>ä¸Šè£…</th>
          <th>ä¸‹è£…</th>
          <th>BMI</th>
          <th>åˆ›å»ºæ—¶é—´</th>
        </tr>
      </thead>
      <tbody id="tableBody">
      </tbody>
    </table>
  </div>

  <!-- ç©ºçŠ¶æ€ -->
  <div id="emptyState" class="empty-state" style="display: none;">
    <div class="empty-icon">ğŸ“­</div>
    <h3 style="color: white; margin-bottom: 10px;">æš‚æ— æ•°æ®</h3>
    <p style="color: rgba(255,255,255,0.7);">è¿˜æ²¡æœ‰ç”¨æˆ·æäº¤èº«æä¿¡æ¯</p>
  </div>

</div>

<script>
// APIåœ°å€ - ä¿®æ”¹ä¸ºä½ çš„Railwayåœ°å€
const API_URL = 'https://web-production-31ba2.up.railway.app/api/records';

// åŠ è½½æ•°æ®
async function loadData() {
  const loading = document.getElementById('loading');
  const tableContainer = document.getElementById('tableContainer');
  const emptyState = document.getElementById('emptyState');
  const errorMsg = document.getElementById('errorMsg');
  
  // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
  loading.style.display = 'block';
  tableContainer.style.display = 'none';
  emptyState.style.display = 'none';
  errorMsg.style.display = 'none';
  
  try {
    const response = await fetch(API_URL);
    const data = await response.json();
    
    if (!data.success) {
      throw new Error(data.error || 'è·å–æ•°æ®å¤±è´¥');
    }
    
    const records = data.records || [];
    
    // éšè—åŠ è½½çŠ¶æ€
    loading.style.display = 'none';
    
    if (records.length === 0) {
      // æ˜¾ç¤ºç©ºçŠ¶æ€
      emptyState.style.display = 'block';
      updateStats(records);
    } else {
      // æ˜¾ç¤ºæ•°æ®è¡¨æ ¼
      tableContainer.style.display = 'block';
      renderTable(records);
      updateStats(records);
    }
    
  } catch (error) {
    console.error('åŠ è½½æ•°æ®é”™è¯¯:', error);
    loading.style.display = 'none';
    errorMsg.textContent = `âŒ åŠ è½½å¤±è´¥: ${error.message}`;
    errorMsg.style.display = 'block';
  }
}

// æ¸²æŸ“è¡¨æ ¼
function renderTable(records) {
  const tbody = document.getElementById('tableBody');
  
  tbody.innerHTML = records.map(record => {
    const genderClass = record.gender === 'female' ? 'badge-female' : 'badge-male';
    const genderText = record.gender === 'female' ? 'å¥³' : 'ç”·';
    
    return `
      <tr>
        <td>${record.id}</td>
        <td><span class="badge ${genderClass}">${genderText}</span></td>
        <td>${record.height} cm</td>
        <td>${record.weight} kg</td>
        <td>${record.bust} cm</td>
        <td>${record.waist} cm</td>
        <td>${record.hips} cm</td>
        <td><span class="size-badge">${record.top_size}</span></td>
        <td><span class="size-badge">${record.bottom_size}</span></td>
        <td>${record.bmi}</td>
        <td>${formatDate(record.created_at)}</td>
      </tr>
    `;
  }).join('');
}

// æ›´æ–°ç»Ÿè®¡æ•°æ®
function updateStats(records) {
  const total = records.length;
  const female = records.filter(r => r.gender === 'female').length;
  const male = records.filter(r => r.gender === 'male').length;
  const avgBmi = total > 0 
    ? (records.reduce((sum, r) => sum + parseFloat(r.bmi), 0) / total).toFixed(1)
    : '-';
  
  document.getElementById('totalCount').textContent = total;
  document.getElementById('femaleCount').textContent = female;
  document.getElementById('maleCount').textContent = male;
  document.getElementById('avgBmi').textContent = avgBmi;
}

// æ ¼å¼åŒ–æ—¥æœŸ
function formatDate(dateStr) {
  const date = new Date(dateStr);
  const now = new Date();
  const diff = now - date;
  const minutes = Math.floor(diff / 60000);
  const hours = Math.floor(diff / 3600000);
  const days = Math.floor(diff / 86400000);
  
  if (minutes < 1) return 'åˆšåˆš';
  if (minutes < 60) return `${minutes}åˆ†é’Ÿå‰`;
  if (hours < 24) return `${hours}å°æ—¶å‰`;
  if (days < 7) return `${days}å¤©å‰`;
  
  return dateStr.split(' ')[0];
}

// é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
loadData();

// æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
setInterval(loadData, 30000);
</script>

</body>
</html>
